# L10 多因子策略 - 改进版（超额收益优化）

> 基于机器学习的多因子量化投资策略，专注于相对基准ETF的超额收益，目标是最大化信息比率

## 📚 文档导航

- **[快速开始 →](QUICK_START.md)** - 5分钟上手指南
- **[聚宽平台指南 →](JOINQUANT_GUIDE.md)** - 详细使用说明和常见问题
- **[改进对比 →](COMPARISON.md)** - 查看改进前后的详细对比
- **[实施总结 →](IMPLEMENTATION_SUMMARY.md)** - 技术实现细节和质量保证

## 📊 项目概述

本项目实现了一个基于多因子模型的量化投资策略，目标是设计一个信息比率尽可能高的策略。**核心改进：预测超额收益（相对标准ETF基准）而非绝对收益。**

## 主要改进

相比原始版本，改进版策略包含以下优化：

### 1. 目标变量优化
- **超额收益目标**：预测相对基准ETF（512100.XSHG）的超额收益
- **信息比率优化**：直接优化超额收益的风险调整指标
- **基准对齐**：训练和预测都以标准ETF收益为基准

### 2. 特征工程增强
- **激进特征选择**：选择相关性前30%的因子（vs 原50%），减少噪声
- **因子交互项**：添加Top-3因子的交互项，捕捉非线性关系
- **降低过拟合**：通过更严格的特征选择和正则化

### 3. 模型优化
- **多模型比较**：测试多个回归模型（Ridge、Lasso、ElasticNet）
- **精细超参数**：更小的正则化参数，更好的拟合能力
- **交叉验证**：使用5折交叉验证选择最佳模型
- **模型选择**：自动选择R2得分最高的模型

### 4. 持仓优化
- **集中持仓**：从50只减少到40只股票
- **提高α**：通过集中持仓增强超额收益潜力

### 5. 训练数据管理
- **时间验证**：确保训练数据严格在start_date之前
- **数据清洗**：去除ST股票、停牌股票和缺失数据
- **标准化处理**：对因子进行标准化和异常值处理

## 📁 文件说明

### 核心文件
- **`L10_improved_strategy.py`** - Python脚本版本，可直接运行
- **`L10_improved_strategy.ipynb`** - Jupyter Notebook版本（**推荐在聚宽平台使用**）

### 文档文件
- **`QUICK_START.md`** - 5分钟快速上手指南 ⭐
- **`JOINQUANT_GUIDE.md`** - 聚宽平台详细使用指南
- **`COMPARISON.md`** - 原版vs改进版详细对比
- **`IMPLEMENTATION_SUMMARY.md`** - 技术实现总结

### 原始文件
- `L10_多因子策略_比赛.html` - 原始策略HTML文档

## 🚀 使用方法

### 在聚宽平台运行

1. 将 `L10_improved_strategy.ipynb` 上传到聚宽研究环境
2. 按顺序运行所有单元格
3. 查看输出的性能指标和图表

> 💡 **提示**：详细的使用说明请参考 [JOINQUANT_GUIDE.md](JOINQUANT_GUIDE.md)

### ⚙️ 配置参数

可以修改以下参数来调整策略：

```python
start_date = datetime.date(2020, 1, 1)  # 回测开始日期
end_date = datetime.date(2025, 12, 15)  # 回测结束日期
investment_horizon = 'M'  # 调仓频率：'M'月度，'W'周度，'d'日度
number_of_periods_per_year = 12  # 对应调仓频率的年化周期数
optimal_stock_count = 40  # 选择的股票数量（集中持仓）
```

## 策略说明

### 因子来源
- 使用聚宽因子库中的 `risk` 和 `basics` 类别因子
- 自动获取所有可用因子

### 股票池
- 中证1000指数成分股（代码：000852.XSHG）
- 排除ST股票和停牌股票

### 选股逻辑
1. 使用训练好的模型预测每只股票的收益率
2. 选择预测收益率最高的N只股票（默认50只）
3. 采用等权重配置

### 交易成本
- 考虑双边0.1%的交易成本（单边0.001）
- 在计算持有期回报时扣除

## 性能指标

策略输出以下性能指标：

- **策略夏普比率**：衡量策略的风险调整后收益
- **基准ETF夏普比率**：中证1000 ETF的夏普比率
- **信息比率**：策略相对基准的超额收益风险调整比率

信息比率 = 超额收益均值 / 超额收益标准差

## 关键约束

1. **不可修改函数签名**：`cal_portfolio_weight_series(decision_date, old_portfolio_weight_series)` 的签名不能改变
2. **训练数据时间**：训练数据必须在start_date之前
3. **输出格式**：保持与原版本相同的输出格式
4. **平台兼容**：代码可在聚宽平台运行

## 预期效果

通过特征选择和模型优化，预期可以实现：

- ✅ 正的信息比率
- ✅ 高于基准的夏普比率
- ✅ 稳定的超额收益
- ✅ 较低的回撤

## 注意事项

1. 首次运行会删除旧的simulation文件，确保从头开始
2. 训练过程可能需要较长时间（取决于数据量）
3. 如果修改了模型或参数，建议删除simulation文件重新运行
4. 交叉验证过程可能显示一些警告，这是正常现象

## 进一步优化建议

如需进一步提升策略表现，可以考虑：

1. **增加更多因子**：尝试使用其他类别的因子
2. **动态股票数量**：根据市场环境动态调整选股数量
3. **加权方式**：尝试按预测收益加权而非等权
4. **集成学习**：使用RandomForest或GradientBoosting等集成方法
5. **时间序列特征**：添加动量、波动率等时间序列特征
6. **市场中性**：考虑行业中性或市值中性约束

## 技术支持

如有问题，请检查：
1. 聚宽平台是否有因子数据访问权限
2. 日期范围是否在数据可用范围内
3. Python环境是否包含所需的sklearn库

## 更新日志

### v1.0 (2025-12-26)
- 初始版本
- 实现特征选择
- 实现多模型比较
- 实现交叉验证
- 添加自动化测试和性能报告
